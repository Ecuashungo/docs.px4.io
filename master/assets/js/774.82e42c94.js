(window.webpackJsonp=window.webpackJsonp||[]).push([[774],{1636:function(s,a,t){"use strict";t.r(a);var e=t(19),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"pilotpi-使用-ubuntu-server-操作系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pilotpi-使用-ubuntu-server-操作系统"}},[s._v("#")]),s._v(" PilotPi 使用 Ubuntu Server 操作系统")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Warning")]),s._v(" 在树莓派4B运行 Ubuntu Server 需要较大电流并会产生不小的热量。 在使用此硬件时考虑高功耗并设计更好的散热。")])]),s._v(" "),t("h2",{attrs:{id:"开发者快速指南"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发者快速指南"}},[s._v("#")]),s._v(" 开发者快速指南")]),s._v(" "),t("h3",{attrs:{id:"操作系统镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作系统镜像"}},[s._v("#")]),s._v(" 操作系统镜像")]),s._v(" "),t("p",[s._v("armhf 与 arm64 都已支持。")]),s._v(" "),t("h4",{attrs:{id:"armhf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#armhf"}},[s._v("#")]),s._v(" armhf")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/18.04.5/release/ubuntu-18.04.5-preinstalled-server-armhf+raspi2.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 18.04.5 for RPi2"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/18.04.5/release/ubuntu-18.04.5-preinstalled-server-armhf+raspi3.img.xz.zsync",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 18.04.5 for RPi3"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/18.04.5/release/ubuntu-18.04.5-preinstalled-server-armhf+raspi4.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 18.04.5 for RPi4"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-armhf+raspi.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 20.04.1 for RPi 2/3/4"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"arm64"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arm64"}},[s._v("#")]),s._v(" arm64")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/18.04.5/release/ubuntu-18.04.5-preinstalled-server-arm64+raspi3.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 18.04.5 for RPi3"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/18.04.5/release/ubuntu-18.04.5-preinstalled-server-arm64+raspi4.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 18.04.5 for RPi4"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/20.04.1/release/ubuntu-20.04.1-preinstalled-server-arm64+raspi.img.xz",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu Server 20.04.1 for RPi 3/4"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"最新操作系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最新操作系统"}},[s._v("#")]),s._v(" 最新操作系统")]),s._v(" "),t("p",[s._v("请从官方 "),t("a",{attrs:{href:"https://cdimage.ubuntu.com/releases/",target:"_blank",rel:"noopener noreferrer"}},[s._v("cdimage"),t("OutboundLink")],1),s._v(" 页面获取最新更新的操作系统。")]),s._v(" "),t("h3",{attrs:{id:"首次启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#首次启动"}},[s._v("#")]),s._v(" 首次启动")]),s._v(" "),t("p",[s._v("当首次设置树莓派的 WiFi 时，我们建议先使用有线网络连接你的路由器与树莓派，并使用显示器和键盘。")]),s._v(" "),t("h4",{attrs:{id:"启动前"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动前"}},[s._v("#")]),s._v(" 启动前")]),s._v(" "),t("p",[s._v("把SD卡挂载到您的电脑上并修改网络设置。 请遵循官方 "),t("a",{attrs:{href:"https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#3-wifi-or-ethernet",target:"_blank",rel:"noopener noreferrer"}},[s._v("指南"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("现在将 SD 卡插入您的 Pi 并首次开机。 请确认您可以获得树莓派的 shell —— 通过有线以太网连接 SSH ，或直接通过键盘和显示器。")]),s._v(" "),t("h4",{attrs:{id:"wifi-区域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wifi-区域"}},[s._v("#")]),s._v(" WiFi 区域")]),s._v(" "),t("p",[s._v("首先安装必需的软件包：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" crda\n")])])]),t("p",[s._v("编辑文件 "),t("code",[s._v("/etc/default/crda")]),s._v(" 以设置正确的 WiFi 区域。 "),t("a",{attrs:{href:"https://www.arubanetworks.com/techdocs/InstantWenger_Mobile/Advanced/Content/Instant%20User%20Guide%20-%20volumes/Country_Codes_List.htm",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考列表"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/default/crda\n")])])]),t("p",[s._v("之后您的 Pi 将能够在重启后加入您的 WiFi 网络。")]),s._v(" "),t("h4",{attrs:{id:"主机名和-mdns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机名和-mdns"}},[s._v("#")]),s._v(" 主机名和 mDNS")]),s._v(" "),t("p",[s._v("让我们先设置主机名。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/hostname\n")])])]),t("p",[s._v("按需更改主机名。 然后安装 mDNS 所需的软件包：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" avahi-daemon\n")])])]),t("p",[s._v("执行重启。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])]),t("p",[s._v("在上述操作后通过无线网络重新连回树莓派。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" ubuntu@pi_hostname.local\n")])])]),t("h4",{attrs:{id:"无密码认证-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#无密码认证-可选"}},[s._v("#")]),s._v(" 无密码认证(可选)")]),s._v(" "),t("p",[s._v("您也可能想要设置 "),t("a",{attrs:{href:"https://www.raspberrypi.org/documentation/remote-access/ssh/passwordless.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("无密码认证"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"配置操作系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置操作系统"}},[s._v("#")]),s._v(" 配置操作系统")]),s._v(" "),t("h4",{attrs:{id:"config-txt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#config-txt"}},[s._v("#")]),s._v(" config.txt")]),s._v(" "),t("p",[s._v("在 Ubuntu 中的相应文件是 "),t("code",[s._v("/boot/firmware/usercfg.txt")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /boot/firmware/usercfg.txt\n")])])]),t("p",[s._v("将文件内容替换为：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable sc16is752 overlay")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dtoverlay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sc16is752-spi1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable I2C-1 and set the frequency to 400KHz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dtparam")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i2c_arm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on,i2c_arm_baudrate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable spidev0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dtparam")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("spi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable RC input")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enable_uart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enable I2C-0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dtparam")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i2c_vc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# switch Bluetooth to miniuart")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dtoverlay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("miniuart-bt\n")])])]),t("h4",{attrs:{id:"cmdline-txt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cmdline-txt"}},[s._v("#")]),s._v(" cmdline.txt")]),s._v(" "),t("p",[s._v("Ubuntu Server 20.04：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /boot/firmware/cmdline.txt\n")])])]),t("p",[s._v("在Ubuntu Server 18.04 或更早版本，"),t("code",[s._v("nobtcmd.txt")]),s._v(" 和 "),t("code",[s._v("btcmd.txt")]),s._v(" 都需要修改。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /boot/firmware/nobtcmd.txt\n")])])]),t("p",[s._v("找到 "),t("code",[s._v("console=/dev/ttyAMA0,115200")]),s._v(" 并删除该部分以禁用串口上的登录shell。")]),s._v(" "),t("p",[s._v("在最后添加 "),t("code",[s._v("isolcpus=2")]),s._v(" 然后整个文件将看起来像：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("net.ifnames"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" dwc_otg.lpm_enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tty1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("root")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LABEL"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("writable "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rootfstype")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ext4 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("elevator")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("deadline rootwait fixrtc "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isolcpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),t("p",[s._v("这告诉Linux内核不要在 CPU 核心2 上调度任何进程。 我们将在稍后手动在该核心运行PX4。")]),s._v(" "),t("p",[s._v("重启并SSH登陆到您的树莓派。")]),s._v(" "),t("p",[s._v("检查串口：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /dev/tty*\n")])])]),t("p",[s._v("应该有 "),t("code",[s._v("/dev/ttyAMA0")]),s._v(", "),t("code",[s._v("/dev/ttySC0")]),s._v(" 和 "),t("code",[s._v("/dev/ttySC1")]),s._v("。")]),s._v(" "),t("p",[s._v("检查 I2C：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /dev/i2c*\n")])])]),t("p",[s._v("应该有 "),t("code",[s._v("/dev/i2c-0")]),s._v(" 和 "),t("code",[s._v("/dev/i2c-1")])]),s._v(" "),t("p",[s._v("检查SPI：:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /dev/spidev*\n")])])]),t("p",[s._v("应该有 "),t("code",[s._v("/dev/spidev0.0")]),s._v("。")]),s._v(" "),t("h4",{attrs:{id:"rc-local"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rc-local"}},[s._v("#")]),s._v(" rc.local")]),s._v(" "),t("p",[s._v("在本节中，我们将在 "),t("strong",[s._v("rc.local")]),s._v(" 中配置自动启动脚本。 请注意，我们需要创建此文件，因为它不存在于新的 Ubuntu OS 上。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/rc.local\n")])])]),t("p",[s._v("将下面的内容写入到文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"25"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/class/gpio/export\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"in"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/class/gpio/gpio25/direction\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /sys/class/gpio/gpio25/value"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Launching PX4"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/ubuntu/px4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" taskset -c "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ./bin/px4 -d -s pilotpi_mc.config "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/ubuntu/px4/px4.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"25"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/class/gpio/unexport\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("p",[s._v("保存并退出。 然后设置正确的权限：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/rc.local\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" 在不需要自启动的时候关闭开关。")])]),s._v(" "),t("h4",{attrs:{id:"csi-相机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#csi-相机"}},[s._v("#")]),s._v(" CSI 相机")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Warning")]),s._v(" 启用 CSI 摄像头将停止在 I2C-0 上工作的任何设备。")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /boot/firmware/usercfg.txt\n")])])]),t("p",[s._v("在文件末尾追加以下行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start_x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("h3",{attrs:{id:"构建代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建代码"}},[s._v("#")]),s._v(" 构建代码")]),s._v(" "),t("p",[s._v("若要在您的计算机上获得"),t("em",[s._v("最新的")]),s._v("版本，请在终端中输入以下命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/PX4/PX4-Autopilot.git --recursive\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" 你只需要执行它就能够得到最新的代码。")])]),s._v(" "),t("h4",{attrs:{id:"配置上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置上传"}},[s._v("#")]),s._v(" 配置上传")]),s._v(" "),t("p",[s._v("设定您的树莓派的 IP (或主机名)：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AUTOPILOT_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".X.X\n")])])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AUTOPILOT_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pi_hostname.local\n")])])]),t("p",[s._v("此外，我们需要设置用户名：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AUTOPILOT_USER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ubuntu\n")])])]),t("h4",{attrs:{id:"为-armhf-目标交叉编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为-armhf-目标交叉编译"}},[s._v("#")]),s._v(" 为 armhf 目标交叉编译")]),s._v(" "),t("p",[s._v("构建可执行程序：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" Firmware\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" scumaker_pilotpi_default\n")])])]),t("p",[s._v("然后上传：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" scumaker_pilotpi_default upload\n")])])]),t("h4",{attrs:{id:"备选armhf构建方法-使用-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备选armhf构建方法-使用-docker"}},[s._v("#")]),s._v(" 备选armhf构建方法 (使用 docker)")]),s._v(" "),t("p",[s._v("如果您是首次使用 Docker 进行编译，请参考"),t("a",{attrs:{href:"https://dev.px4.io/master/en/test_and_ci/docker.html#prerequisites",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方说明"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("在 PX4-Autopilot 文件夹下执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./Tools/docker_run.sh "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"export AUTOPILOT_HOST=192.168.X.X; export AUTOPILOT_USER=ubuntu; export NO_NINJA_BUILD=1; make scumaker_pilotpi_default upload"')]),s._v("\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" Docker 暂不支持 mDNS。 每次上传时，您必须指定正确的IP地址。")])]),s._v(" "),t("p",[t("span")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" 如果你的 IDE 不支持 ninja 构建，可以设置"),t("code",[s._v("NO_NINJA_BUILD=1")]),s._v("变量。 您也可以编译而不上传。 只需要删除 "),t("code",[s._v("upload")]),s._v(" 参数。")])]),s._v(" "),t("p",[s._v("只是为了编译代码，则可以执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./Tools/docker_run.sh "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"make scumaker_pilotpi_default"')]),s._v("\n")])])]),t("h4",{attrs:{id:"为arm64交叉编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为arm64交叉编译"}},[s._v("#")]),s._v(" 为arm64交叉编译")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("注意")]),s._v(" 此步骤需要安装 "),t("code",[s._v("aarch64-linux-gnu")]),s._v(" 工具链。")])]),s._v(" "),t("p",[s._v("构建可执行程序：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" PX4-Autopilot\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" scumaker_pilotpi_arm64\n")])])]),t("p",[s._v("然后上传：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" scumaker_pilotpi_arm64 upload\n")])])]),t("h4",{attrs:{id:"备选-arm64-构建方法-使用-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备选-arm64-构建方法-使用-docker"}},[s._v("#")]),s._v(" 备选 arm64 构建方法 (使用 docker)")]),s._v(" "),t("p",[s._v("如果您是首次使用 Docker 进行编译，请参考"),t("a",{attrs:{href:"https://dev.px4.io/master/en/test_and_ci/docker.html#prerequisites",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方说明"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("在 PX4-Autopilot 文件夹下执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./Tools/docker_run.sh "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"export AUTOPILOT_HOST=192.168.X.X; export AUTOPILOT_USER=ubuntu; export NO_NINJA_BUILD=1; make scumaker_pilotpi_arm64 upload"')]),s._v("\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" Docker 暂不支持 mDNS。 每次上传时，您必须指定正确的IP地址。")])]),s._v(" "),t("p",[t("span")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Note")]),s._v(" 如果你的 IDE 不支持 ninja 构建，可以设置"),t("code",[s._v("NO_NINJA_BUILD=1")]),s._v("变量。 您可以只编译而无需上传 - 只需删除 "),t("code",[s._v("upload")]),s._v(" 字段。")])]),s._v(" "),t("p",[s._v("只是为了编译代码，则可以执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./Tools/docker_run.sh "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"make scumaker_pilotpi_arm64"')]),s._v("\n")])])]),t("h4",{attrs:{id:"手动运行-px4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手动运行-px4"}},[s._v("#")]),s._v(" 手动运行 PX4")]),s._v(" "),t("p",[s._v("通过 ssh 连接并运行它：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" px4\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" taskset -c "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ./bin/px4 -s pilotpi_mc.config\n")])])]),t("p",[s._v("PX4 已配置使用多旋翼模型启动。")]),s._v(" "),t("p",[s._v("如果在树莓派上运行PX4时遇到了以下问题：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/px4: /lib/xxxx/xxxx: version `GLIBC_2.29' not found (required by bin/px4)\n")])])]),t("p",[s._v("这时应当使用基于 Docker 的编译。")]),s._v(" "),t("p",[s._v("在执行下一步之前，先清除现有构建目录：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf build/scumaker_pilotpi_*\n")])])]),t("p",[s._v("然后回到上面相应的章节。")]),s._v(" "),t("h3",{attrs:{id:"后期配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后期配置"}},[s._v("#")]),s._v(" 后期配置")]),s._v(" "),t("p",[s._v("请参阅 "),t("RouterLink",{attrs:{to:"/zh/flight_controller/raspberry_pi_pilotpi_rpios.html"}},[s._v("这里的说明")])],1)])}),[],!1,null,null,null);a.default=r.exports}}]);