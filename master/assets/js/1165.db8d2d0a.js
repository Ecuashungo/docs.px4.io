(window.webpackJsonp=window.webpackJsonp||[]).push([[1165],{2498:function(e,t,r){"use strict";r.r(t);var a=r(19),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"flight-controller-porting-guide"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#flight-controller-porting-guide"}},[e._v("#")]),e._v(" Flight Controller Porting Guide")]),e._v(" "),r("p",[e._v("This topic is for developers who want to port PX4 to work with "),r("em",[e._v("new")]),e._v(" flight controller hardware.")]),e._v(" "),r("h2",{attrs:{id:"px4-architecture"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#px4-architecture"}},[e._v("#")]),e._v(" PX4 Architecture")]),e._v(" "),r("p",[e._v("PX4 consists of two main layers: The "),r("RouterLink",{attrs:{to:"/zh/middleware/"}},[e._v("board support and middleware layer")]),e._v(" on top of the host OS (NuttX, Linux or any other POSIX platform like Mac OS), and the applications (Flight Stack in "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/src/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("src/modules"),r("OutboundLink")],1),e._v("). Please reference the "),r("RouterLink",{attrs:{to:"/zh/concept/architecture.html"}},[e._v("PX4 Architectural Overview")]),e._v(" for more information.  Please reference the "),r("RouterLink",{attrs:{to:"/zh/concept/architecture.html"}},[e._v("PX4 Architectural Overview")]),e._v(" for more information.")],1),e._v(" "),r("p",[e._v("This guide is focused only on the host OS and middleware as the applications/flight stack will run on any board target.")]),e._v(" "),r("h2",{attrs:{id:"flight-controller-configuration-file-layout"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#flight-controller-configuration-file-layout"}},[e._v("#")]),e._v(" Flight Controller Configuration File Layout")]),e._v(" "),r("p",[e._v("Board startup and configuration files are located under "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/boards/",target:"_blank",rel:"noopener noreferrer"}},[e._v("/boards"),r("OutboundLink")],1),e._v(" in each board's vendor-specific directory (i.e. "),r("strong",[e._v("boards/"),r("em",[e._v("VENDOR")]),e._v("/"),r("em",[e._v("MODEL")]),e._v("/")]),e._v(")).")]),e._v(" "),r("p",[e._v("For example, for FMUv5:")]),e._v(" "),r("ul",[r("li",[e._v("(All) Board-specific files: "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/boards/px4/fmu-v5",target:"_blank",rel:"noopener noreferrer"}},[e._v("/boards/px4/fmu-v5"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("li",[e._v("Build configuration: "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/blob/master/boards/px4/fmu-v5/default.cmake",target:"_blank",rel:"noopener noreferrer"}},[e._v("/boards/px4/fmu-v5/default.cmake"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("li",[e._v("Board-specific initialisation file: "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/blob/master/boards/px4/fmu-v5/init/rc.board",target:"_blank",rel:"noopener noreferrer"}},[e._v("/boards/px4/fmu-v5/init/rc.board"),r("OutboundLink")],1),e._v(" "),r("ul",[r("li",[e._v("A board-specific initialisation file is automatically included in startup scripts if found under the boards directory at "),r("strong",[e._v("init/rc.board")]),e._v(".")]),e._v(" "),r("li",[e._v("The file is used to start sensors (and other things) that only exist on a particular board. The file is used to start sensors (and other things) that only exist on a particular board. It may also be used to set a board's default parameters, UART mappings, and any other special cases.")]),e._v(" "),r("li",[e._v("For FMUv5 you can see all the Pixhawk 4 sensors being started, and it also sets a larger LOGGER_BUF, and in AUTOCNF section (fresh setups) it sets the "),r("RouterLink",{attrs:{to:"/zh/advanced/parameter_reference.html#SYS_FMU_TASK"}},[e._v("SYS_FMU_TASK")]),e._v(" parameter.")],1)])])]),e._v(" "),r("h2",{attrs:{id:"host-operating-system-configuration"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#host-operating-system-configuration"}},[e._v("#")]),e._v(" Host Operating System Configuration")]),e._v(" "),r("p",[e._v("This section describes the purpose and location of the configuration files required for each supported host operating system to port them to new flight controller hardware.")]),e._v(" "),r("h3",{attrs:{id:"nuttx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nuttx"}},[e._v("#")]),e._v(" NuttX")]),e._v(" "),r("p",[e._v("See "),r("RouterLink",{attrs:{to:"/zh/hardware/porting_guide_nuttx.html"}},[e._v("NuttX Board Porting Guide")]),e._v(".")],1),e._v(" "),r("h3",{attrs:{id:"linux"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[e._v("#")]),e._v(" Linux")]),e._v(" "),r("p",[e._v("Linux boards do not include the OS and kernel configuration. Linux boards do not include the OS and kernel configuration. These are already provided by the Linux image available for the board (which needs to support the inertial sensors out of the box).")]),e._v(" "),r("ul",[r("li",[e._v("The boot file system (startup script) is located in: "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/ROMFS/px4fmu_common",target:"_blank",rel:"noopener noreferrer"}},[e._v("ROMFS/px4fmu_common"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"middleware-components-and-configuration"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#middleware-components-and-configuration"}},[e._v("#")]),e._v(" Middleware Components and Configuration")]),e._v(" "),r("p",[e._v("This section describes the various middleware components, and the configuration file updates needed to port them to new flight controller hardware.")]),e._v(" "),r("h3",{attrs:{id:"qurt-hexagon"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#qurt-hexagon"}},[e._v("#")]),e._v(" QuRT / Hexagon")]),e._v(" "),r("ul",[r("li",[e._v("The start script is located in "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/posix-configs",target:"_blank",rel:"noopener noreferrer"}},[e._v("posix-configs/"),r("OutboundLink")],1),e._v(". ")]),e._v(" "),r("li",[e._v("The OS configuration is part of the default Linux image (TODO: Provide location of LINUX IMAGE and flash instructions).")]),e._v(" "),r("li",[e._v("The PX4 middleware configuration is located in "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/tree/master/src/drivers/boards",target:"_blank",rel:"noopener noreferrer"}},[e._v("src/drivers/boards"),r("OutboundLink")],1),e._v(". TODO: ADD BUS CONFIG "),e._v(" TODO: ADD BUS CONFIG")]),e._v(" "),r("li",[e._v("Reference config: Running "),r("code",[e._v("make eagle_default")]),e._v(" builds the Snapdragon Flight reference config.")])]),e._v(" "),r("h2",{attrs:{id:"rc-uart-wiring-recommendations"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rc-uart-wiring-recommendations"}},[e._v("#")]),e._v(" RC UART Wiring Recommendations")]),e._v(" "),r("p",[e._v("It is generally recommended to connect RC via separate RX and TX pins to the microcontroller. If however RX and TX are connected together, the UART has to be put into singlewire mode to prevent any contention. This is done via board config and manifest files. One example is "),r("a",{attrs:{href:"https://github.com/PX4/Firmware/blob/master/src/drivers/boards/px4fmu-v5/manifest.c",target:"_blank",rel:"noopener noreferrer"}},[e._v("px4fmu-v5"),r("OutboundLink")],1),e._v(". If however RX and TX are connected together, the UART has to be put into singlewire mode to prevent any contention. This is done via board config and manifest files. One example is "),r("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/master/boards/px4/fmu-v5/src/manifest.c",target:"_blank",rel:"noopener noreferrer"}},[e._v("px4fmu-v5"),r("OutboundLink")],1),e._v(". ")]),e._v(" "),r("h2",{attrs:{id:"officially-supported-hardware"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#officially-supported-hardware"}},[e._v("#")]),e._v(" Officially Supported Hardware")]),e._v(" "),r("p",[e._v("The PX4 project supports and maintains the "),r("RouterLink",{attrs:{to:"/zh/hardware/reference_design.html"}},[e._v("FMU standard reference hardware")]),e._v(" and any boards that are compatible with the standard. The PX4 project supports and maintains the "),r("RouterLink",{attrs:{to:"/zh/debug/reference-design.html"}},[e._v("FMU standard reference hardware")]),e._v(" and any boards that are compatible with the standard. This includes the "),r("a",{attrs:{href:"https://docs.px4.io/en/flight_controller/pixhawk_series.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pixhawk-series"),r("OutboundLink")],1),e._v(" (see the user guide for a "),r("a",{attrs:{href:"https://docs.px4.io/en/flight_controller/",target:"_blank",rel:"noopener noreferrer"}},[e._v("full list of officially supported hardware"),r("OutboundLink")],1),e._v(").")],1),e._v(" "),r("p",[e._v("Every officially supported board benefits from:")]),e._v(" "),r("ul",[r("li",[e._v("PX4 Port available in the PX4 repository")]),e._v(" "),r("li",[e._v("Automatic firmware builds that are accessible from "),r("em",[e._v("QGroundControl")])]),e._v(" "),r("li",[e._v("Compatibility with the rest of the ecosystem")]),e._v(" "),r("li",[e._v("Automated checks via CI - safety remains paramount to this community")]),e._v(" "),r("li",[r("RouterLink",{attrs:{to:"/zh/test_and_ci/test_flights.html"}},[e._v("Flight testing")])],1)]),e._v(" "),r("p",[e._v("We encourage board manufacturers to aim for full compatibility with the "),r("a",{attrs:{href:"https://pixhawk.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("FMU spec"),r("OutboundLink")],1),e._v(". We encourage board manufacturers to aim for full compatibility with the "),r("a",{attrs:{href:"https://pixhawk.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("FMU spec"),r("OutboundLink")],1),e._v(". With full compatibility you benefit from the ongoing day-to-day development of PX4, but have none of the maintenance costs that come from supporting deviations from the specification.")]),e._v(" "),r("blockquote",[r("p",[r("strong",[e._v("Note")]),e._v(" The following steps are not required if using the "),r("a",{attrs:{href:"https://hub.docker.com/r/px4io/px4-dev-nuttx/",target:"_blank",rel:"noopener noreferrer"}},[e._v("px4-dev-nuttx"),r("OutboundLink")],1),e._v(" docker container or have installed to macOS using our normal instructions (as these include"),r("code",[e._v("kconfig-mconf")]),e._v(").")])]),e._v(" "),r("p",[e._v("For fresh installs of PX4 onto Ubuntu using "),r("a",{attrs:{href:"https://raw.githubusercontent.com/PX4/Devguide/master/build_scripts/ubuntu_sim_nuttx.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("ubuntu_sim_nuttx.sh"),r("OutboundLink")],1),e._v(" you will also need to install "),r("em",[e._v("kconfig")]),e._v(" tools from "),r("a",{attrs:{href:"https://bitbucket.org/nuttx/tools/src/master/",target:"_blank",rel:"noopener noreferrer"}},[e._v("NuttX tools"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("It's also important to note that the PX4 dev team has a responsibility to release safe software, and as such we require any board manufacturer to commit any resources necessary to keep their port up-to-date, and in a working state.")]),e._v(" "),r("p",[e._v("If you want to have your board officially supported in PX4:")]),e._v(" "),r("ul",[r("li",[e._v("Your hardware must be available in the market (i.e. it can be purchased by any developer without restriction).")]),e._v(" "),r("li",[e._v("Hardware must be made available to the PX4 Dev Team so that they can validate the port (contact "),r("a",{attrs:{href:"mailto:lorenz@px4.io"}},[e._v("lorenz@px4.io")]),e._v(" for guidance on where to ship hardware for testing).")]),e._v(" "),r("li",[e._v("The board must pass full "),r("RouterLink",{attrs:{to:"/zh/test_and_ci/"}},[e._v("test suite")]),e._v(" and "),r("RouterLink",{attrs:{to:"/zh/test_and_ci/test_flights.html"}},[e._v("flight testing")]),e._v(".")],1)]),e._v(" "),r("p",[r("strong",[e._v("The PX4 project reserves the right to refuse acceptance of new ports (or remove current ports) for failure to meet the requirements set by the project.")])]),e._v(" "),r("p",[e._v("You can reach out to the core developer team and community on the official "),r("RouterLink",{attrs:{to:"/zh/#support"}},[e._v("Forums and Chat")]),e._v(".")],1),e._v(" "),r("h2",{attrs:{id:"related-information"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#related-information"}},[e._v("#")]),e._v(" Related Information")]),e._v(" "),r("ul",[r("li",[r("RouterLink",{attrs:{to:"/zh/middleware/drivers.html"}},[e._v("Device Drivers")]),e._v(" - How to support new peripheral hardware (device drivers)")],1),e._v(" "),r("li",[r("RouterLink",{attrs:{to:"/zh/setup/building_px4.html"}},[e._v("Building the Code")]),e._v(" - How to build source and upload firmware")],1),e._v(" "),r("li",[e._v("Supported Flight Controllers:\n"),r("ul",[r("li",[r("a",{attrs:{href:"https://docs.px4.io/en/flight_controller/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Autopilot Hardware"),r("OutboundLink")],1),e._v(" (PX4 User Guide)")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/PX4/Firmware/#supported-hardware",target:"_blank",rel:"noopener noreferrer"}},[e._v("Supported boards list"),r("OutboundLink")],1),e._v(" (Github)")])])]),e._v(" "),r("li",[r("a",{attrs:{href:"https://docs.px4.io/en/peripherals/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Supported Peripherals"),r("OutboundLink")],1),e._v(" (PX4 User Guide)")])])])}),[],!1,null,null,null);t.default=o.exports}}]);