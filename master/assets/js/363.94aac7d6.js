(window.webpackJsonp=window.webpackJsonp||[]).push([[363],{1139:function(t,s,a){t.exports=a.p+"assets/img/architecture.94eff761.png"},1140:function(t,s,a){t.exports=a.p+"assets/img/architecture_ros2.f0ce052c.png"},1141:function(t,s,a){t.exports=a.p+"assets/img/architecture_ros.a06cff99.png"},2513:function(t,s,a){"use strict";a.r(s);var e=a(18),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"rtps-ros2-接口-px4-fastrtps桥接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rtps-ros2-接口-px4-fastrtps桥接"}},[t._v("#")]),t._v(" RTPS/ROS2 接口：PX4-FastRTPS桥接")]),t._v(" "),e("p",[e("em",[t._v("PX4-fastRTPS 桥接")]),t._v(" 在 PX4 中添加了一个实时发布订阅 (RTPS) 接口, 从而能够在PX4组件和 (offboard) "),e("em",[t._v("Fast RTPS")]),t._v(" 应用程序 (包括使用 ROS2/ROS 框架构建的应用程序) 之间进行 "),e("RouterLink",{attrs:{to:"/zh/middleware/uorb.html"}},[t._v("uORB 消息")]),t._v(" 交换。")],1),t._v(" "),e("p",[t._v("RTPS 已被采用为 ROS2 (机器人操作系统) 的中间件。 *Fast RTPS桥接 * 使我们能够更好地与 ROS2 集成, 从而轻松共享传感器值、命令和其他车辆信息。 "),e("em",[t._v("Fast RTPS")]),t._v(" is a very lightweight cross-platform implementation of the latest version of the RTPS protocol and a minimum DDS API.\n:::")]),t._v(" "),e("p",[t._v("本主题介绍RTPS桥接体系结构 (以及如何在 ROS2/ROS 应用程序管道中使用它)。 还演示了如何编译所需的代码, 以便:")]),t._v(" "),e("p",[t._v("当您需要在飞行控制器和offboard部件之间可靠地共享时间敏感/实时信息时, 应使用RTPS。 特别是, 在off-board软件需要 (通过发送和接收 uORB主题) 成为 px4 中运行的软件组件的 "),e("em",[t._v("伙伴")]),t._v(" 的情况下，它非常有用。")]),t._v(" "),e("ol",[e("li",[t._v("编写一个简单的 *Fast rtps * 应用程序来订阅PX4消息")]),t._v(" "),e("li",[t._v("在PX4上连接ROS2节点 (通过RTPS桥接, 并使用 "),e("code",[t._v("px4_ros_com")]),t._v(" 包)")]),t._v(" "),e("li",[t._v('如果要在PX4上连接ROS (ROS "1代")，需要额外使用 '),e("code",[t._v("ros1_bridge")]),t._v(" 包在ROS2和ROS之间做桥接。")])]),t._v(" "),e("h2",{attrs:{id:"什么时候应该使用-rtps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么时候应该使用-rtps"}},[t._v("#")]),t._v(" 什么时候应该使用 RTPS？")]),t._v(" "),e("p",[t._v("RTPS should be used when you need to reliably share time-critical/real-time information between the flight controller and off board components. In particular it is useful in cases where off-board software needs to become a "),e("em",[t._v("peer")]),t._v(" of software components running in PX4 (by sending and receiving uORB topics).")]),t._v(" "),e("p",[t._v("RTPS 桥接在 PX4 和 RTPS 应用程序之间交换消息, 在每个系统使用的 "),e("RouterLink",{attrs:{to:"/zh/middleware/uorb.html"}},[t._v("uORB")]),t._v(" 和 RTPS 消息之间无缝转换。")],1),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[e("em",[t._v("Fast RTPS")]),t._v(" is not intended as a replacement for MAVLink. MAVLink remains the most appropriate protocol for communicating with ground stations, gimbals, cameras, and other offboard components (although "),e("em",[t._v("Fast RTPS")]),t._v(" may open other opportunities for working with some peripherals).")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("RTPS can be used over slower links (e.g. radio telemetry), but care should be taken not to overload the channel.")])]),t._v(" "),e("h2",{attrs:{id:"架构概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#架构概述"}},[t._v("#")]),t._v(" 架构概述")]),t._v(" "),e("h3",{attrs:{id:"rtps-桥接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rtps-桥接"}},[t._v("#")]),t._v(" RTPS 桥接")]),t._v(" "),e("p",[t._v("The RTPS bridge exchanges messages between PX4 and RTPS applications, seamlessly converting between the "),e("RouterLink",{attrs:{to:"/zh/middleware/uorb.html"}},[t._v("uORB")]),t._v(" and RTPS messages used by each system.")],1),t._v(" "),e("p",[e("img",{attrs:{src:a(1139),alt:"Architecture with ROS2"}})]),t._v(" "),e("p",[t._v("将 ROS 应用程序与 PX4 集成的体系结构如下所示。")]),t._v(" "),e("ul",[e("li",[e("em",[t._v("Client")]),t._v(" 是在飞行控制器上运行的 PX4 中间件守护进程。 它订阅由其他 PX4 组件发布的 uORB 主题, 并将更新发送给 "),e("em",[t._v("Agent")]),t._v(" (通过 UART 或 UDP 端口)。 它还接收来自 "),e("em",[t._v("Agent")]),t._v(" 的消息, 转换为 PX4 上的 uORB 消息并重新发布。")]),t._v(" "),e("li",[e("em",[t._v("Agent")]),t._v(" 在Offboard计算机上作为守护进程运行。 它监视来自 "),e("em",[t._v("Client")]),t._v(' 的 uORB 消息更新, 并通过RTPS (重新) 发布这些消息。 它还订阅来自其他 RTPS 应用程序的 "uORB" RTPS 消息, 并直接转发给 '),e("em",[t._v("Client")]),t._v("。")]),t._v(" "),e("li",[e("em",[t._v("Agent")]),t._v(" 和 "),e("em",[t._v("Client")]),t._v(" 通过串行链路 (UART) 或 UDP 网络进行连接。 uORB 信息事先经过了 "),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Common_Data_Representation",target:"_blank",rel:"noopener noreferrer"}},[t._v("CDR 序列化 "),e("OutboundLink")],1),t._v(" 处理 (*CDR 序列化 * 提供了一种在不同平台之间交换串行数据的通用格式)。")]),t._v(" "),e("li",[e("em",[t._v("Agent")]),t._v(" 和任何 "),e("em",[t._v("Fast RTPS")]),t._v(" 应用程序之间都是通过 UDP 连接的, 二者可以运行在同一设备上，也可以运行在不同设备上。 在一种典型的配置中, 它们运行于同一系统 (例如, 开发计算机、Linux 配套计算机或计算机板) 上, 通过 Wifi或 USB 连接到 "),e("em",[t._v("Client")]),t._v("。")])]),t._v(" "),e("h3",{attrs:{id:"ros2-ros-应用处理流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ros2-ros-应用处理流程"}},[t._v("#")]),t._v(" ROS2/ROS 应用处理流程")]),t._v(" "),e("p",[t._v("The application pipeline for ROS2 is very straightforward! Because ROS2 uses DDS/RTPS as its native communications middleware, you can create a ROS2 listener or advertiser node to publish and subscribe to uORB data on PX4, via the "),e("em",[t._v("PX4 Fast RTPS Bridge")]),t._v(". This is shown below.")]),t._v(" "),e("p",[t._v("请注意 "),e("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),e("OutboundLink")],1),t._v("的使用, 它在 ROS2 和 ROS 之间进行消息桥接。 因为 ROS 一代不支持 RTPS，所以只能这样做。\n:::")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1140),alt:"Architecture with ROS2"}})]),t._v(" "),e("p",[t._v("The architecture for integrating ROS applications with PX4 is shown below.")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1141),alt:"Architecture with ROS"}})]),t._v(" "),e("p",[t._v("Note the use of "),e("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),e("OutboundLink")],1),t._v(", which bridges messages between ROS2 and ROS. This is needed because the first version of ROS does not support RTPS.")]),t._v(" "),e("h2",{attrs:{id:"代码生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码生成"}},[t._v("#")]),t._v(" 代码生成")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/zh/dev_setup/fast-rtps-installation.html"}},[t._v("Fast RTPS 1.8.2 and FastRTPSGen 1.0.4 or later must be installed")]),t._v(" in order to generate the required code!")],1)]),t._v(" "),e("h3",{attrs:{id:"独立于-ros-的应用程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#独立于-ros-的应用程序"}},[t._v("#")]),t._v(" 独立于 ROS 的应用程序")]),t._v(" "),e("p",[t._v("All the code needed to create, build and use the bridge is automatically generated when PX4-Autopilot is compiled.")]),t._v(" "),e("p",[t._v("生成的桥接代码将允许通过 RTPS 发布/订阅部分 uORB 主题。 这对于 ROS 或非 ROS 应用程序都是适用的。")]),t._v(" "),e("p",[t._v("为了 "),e("em",[t._v("自动生成代码")]),t._v("，在 PX4 "),e("strong",[t._v("Firmware/msg/tools/")]),t._v(" 目录下有一个 "),e("em",[t._v("yaml")]),t._v(" 定义文件 —— "),e("strong",[t._v("uorb_rtps_message_ids.yaml")]),t._v("。 该文件定义了 RTPS 可以使用的 uORB 消息子集，以及是用于发送、用于接收还是双向皆可，以及用于 DDS/RTPS 中间件的 RTPS ID。\n:::")]),t._v(" "),e("p",[e("a",{attrs:{id:"px4_ros_com"}})]),t._v(" "),e("h3",{attrs:{id:"ros2-ros-应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ros2-ros-应用"}},[t._v("#")]),t._v(" ROS2/ROS 应用")]),t._v(" "),e("p",[t._v("The "),e("a",{attrs:{href:"https://github.com/PX4/px4_ros_com",target:"_blank",rel:"noopener noreferrer"}},[t._v("px4_ros_com"),e("OutboundLink")],1),t._v(" package, when built, generates everything needed to access PX4 uORB messages from a ROS2 node (for ROS you also need "),e("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),e("OutboundLink")],1),t._v("). This includes all the required components of the "),e("em",[t._v("PX4 RTPS bridge")]),t._v(", including the "),e("code",[t._v("micrortps_agent")]),t._v(" and the IDL files (required by the "),e("code",[t._v("micrortps_agent")]),t._v(").")]),t._v(" "),e("p",[t._v("要构建 NuttX/Pixhawk 飞行控制器的固件, 请选择带有 "),e("code",[t._v("_rtps")]),t._v(" 的配置文件。 例如，要为 px4_fmu-v4 构建 RTPS：")]),t._v(" "),e("p",[t._v("如果要构建 SITL 固件:")]),t._v(" "),e("ul",[e("li",[t._v("一个支持 ROS2 的 "),e("code",[t._v("master")]),t._v(" 分支。 该分支的代码可以生成在 PX4 和 ROS2 之间桥接必需的所有 ROS2 消息和 IDL 文件。")]),t._v(" "),e("li",[t._v("一个支持 ROS 一代的 "),e("code",[t._v("ros1")]),t._v(" 分支。 该分支的代码可以生成 ROS 消息的头文件和源文件，这些文件与 "),e("code",[t._v("ros1_bridge")]),t._v(" "),e("em",[t._v("一起")]),t._v(" 使用，达到在PX4与ROS之间共享数据的目的。")])]),t._v(" "),e("p",[t._v("Both branches in "),e("code",[t._v("px4_ros_com")]),t._v(" additionally include some example listener and advertiser example nodes.")]),t._v(" "),e("h2",{attrs:{id:"支持的-uorb-消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持的-uorb-消息"}},[t._v("#")]),t._v(" 支持的 uORB 消息")]),t._v(" "),e("p",[t._v("The generated bridge code will enable a specified subset of uORB topics to be published/subscribed via RTPS. This is true for both ROS or non-ROS applications.")]),t._v(" "),e("p",[t._v("编译PX4固件时，相关的"),e("em",[t._v("Agent")]),t._v("代码会自动被 "),e("em",[t._v("生成")]),t._v("。 生成的源代码在这个目录下: "),e("strong",[t._v("build/"),e("target-platform",[t._v("/src/modules/micrortps_bridge/micrortps_client/micrortps_agent/")])],1),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("An RTPS ID must be set for all messages.")])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rtps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_armed\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_control\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rtps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_armed\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_control\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" airspeed\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" battery_status\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" camera_capture\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" camera_trigger\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sensor_baro\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sensor_baro\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("An API change in ROS2 Dashing means that we now use the "),e("code",[t._v("rosidl_generate_interfaces()")]),t._v(" CMake module (in "),e("code",[t._v("px4_msgs")]),t._v(") to generate the IDL files that we require for microRTPS agent generation (in "),e("code",[t._v("px4_ros_com")]),t._v("). PX4-Autopilot includes a template for the IDL file generation, which is only used during the PX4 build process.")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("px4_msgs")]),t._v(" build generates "),e("em",[t._v("slightly different")]),t._v(" IDL files for use with ROS2/ROS (than are built for PX4 firmware). The "),e("strong",[t._v("uorb_rtps_message_ids.yaml")]),t._v(" is transformed in a way that the message names become "),e("em",[t._v("PascalCased")]),t._v(" (the name change is irrelevant to the client-agent communication, but is critical for ROS2, since the message naming must follow the PascalCase convention). The new IDL files also reverse the messages that are sent and received (required because if a message is sent from the client side, then it's received on the agent side, and vice-versa).")])]),t._v(" "),e("p",[e("a",{attrs:{id:"client_firmware"}})]),t._v(" "),e("h2",{attrs:{id:"客户端-px4固件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端-px4固件"}},[t._v("#")]),t._v(" 客户端 (PX4固件)")]),t._v(" "),e("p",[t._v("为了构建 "),e("em",[t._v("Agent")]),t._v(" 应用, 运行如下编译命令:")]),t._v(" "),e("p",[t._v("构建 "),e("code",[t._v("px4_ros_com")]),t._v(" 将自动生成并编译代理端应用。 也可以使用 "),e("a",{attrs:{href:"http://design.ros2.org/articles/build_tool.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("colcon")]),e("OutboundLink")],1),t._v(" 构建工具, 效果与上相同。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_fmu-v4_rtps\n")])])]),e("p",[t._v("要在一台 Ubuntu 18.04 机器上安装 ROS Melodic 和 ROS2 Bouncy, 分别参考如下链接:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_sitl_rtps\n")])])]),e("p",[t._v("The "),e("em",[t._v("Client")]),t._v(" application can be launched from "),e("RouterLink",{attrs:{to:"/zh/debug/system_console.html"}},[t._v("NuttShell/System Console")]),t._v(". The command syntax is shown below (you can specify a variable number of arguments):")],1),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" micrortps_client start"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  -t "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("transport"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UART"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UDP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 缺省为 UART\n  -d "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART 设备. 缺省为 /dev/ttyACM0\n  -u "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("update_time_ms"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     订阅的 uORB 消息的刷新时间，单位ms。 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  -l "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("loops"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("              该程序将循环执行多少次。 Default /dev/ttyACM0\n  -l "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("loops"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              How many iterations will this program have. -1 表示无限循环， 缺省为 -1。 缺省为 -1。\n  -w "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sleep_time_us"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      每次循环的休眠时间，单位us。 缺省为 1ms\n  -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("baudrate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           UART 设备波特率 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("460800")]),t._v("\n  -p "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("poll_ms"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            UART设备轮询时间，单位ms， 缺省为 1ms\n  -r "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP接收端口号， -r "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP 接收端口， 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("。 -s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sending port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       UDP发送端口， 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("。 Default "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("\n  -i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ip_address"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         Select IP address "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("remote"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" values: "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("x.x.x.x"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(". Default: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1\n")])])]),e("p",[t._v("由于 ROS2 和 ROS 环境变量的配置不同，你需要为每个 ROS 版本分配独立的工作空间。 下面是一个例子：\n:::")]),t._v(" "),e("p",[e("code",[t._v("px4_ros_com/scripts")]),t._v(" 目录下有几个脚本可以用来构建这两个工作空间。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("micrortps_client start -t UDP\n")])])]),e("h2",{attrs:{id:"与-ros-无关的-offboard-fast-rtps-接口中的代理端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与-ros-无关的-offboard-fast-rtps-接口中的代理端"}},[t._v("#")]),t._v(" 与 ROS 无关的 Offboard Fast RTPS 接口中的代理端")]),t._v(" "),e("p",[e("code",[t._v("build_all.bash")]),t._v(" 这个脚本可以一次性编译两个工作空间。 使用命令 "),e("code",[t._v("source build_all.bash --help")]),t._v(" 查看脚本的用法。")]),t._v(" "),e("p",[t._v("以下步骤将详述怎样 "),e("em",[t._v("手动")]),t._v(" 构建这些程序包 (只是为了加深您的理解):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" build/"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("target-platform"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/src/modules/micrortps_bridge/micrortps_client/micrortps_agent\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" build "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" build\ncmake "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("To cross-compile for the "),e("em",[t._v("Qualcomm Snapdragon Flight")]),t._v(" platform see "),e("a",{attrs:{href:"https://github.com/eProsima/PX4-FastRTPS-PoC-Snapdragon-UDP#how-to-use",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("p",[t._v("The command syntax for the "),e("em",[t._v("Agent")]),t._v(" is listed below:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ ./micrortps_agent "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  -t "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("transport"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UART"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UDP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 缺省为UART.\n  -d "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART设备， 缺省为 /dev/ttyACM0。\n  -d "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART设备， 缺省为 /dev/ttyACM0。\n  -w "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sleep_time_us"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      每次循环的休眠时间，单位us。 默认 1ms。\n  -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("baudrate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           UART设备波特率。 默认 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("460800")]),t._v("。\n  -p "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("poll_ms"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            UART设备轮询时间，单位ms， 缺省为 1ms。 缺省为 1ms。\n  -r "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP 接收端口， 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("。\n  -s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sending port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       UDP发送端口， 缺省为 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("。\n")])])]),e("p",[t._v("To launch the "),e("em",[t._v("Agent")]),t._v(", run "),e("code",[t._v("micrortps_agent")]),t._v(" with appropriate options for specifying the connection to the "),e("em",[t._v("Client")]),t._v(" (the default options connect from a Linux device to the "),e("em",[t._v("Client")]),t._v(" over a UART port).")]),t._v(" "),e("p",[t._v("一旦 "),e("em",[t._v("Client")]),t._v(" (在飞行控制器上) 和 "),e("em",[t._v("Agent")]),t._v(" (在一台 offboard 计算机上) 同时运行并且成功互联, "),e("em",[t._v("Fast RTPS")]),t._v(" 应用就可以通过 RTPS 发布或订阅PX4 上的 uORB 消息。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("./micrortps_agent -t UDP\n")])])]),e("h2",{attrs:{id:"面向-ros2-中间件的代理端接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面向-ros2-中间件的代理端接口"}},[t._v("#")]),t._v(" 面向 ROS2 中间件的代理端接口")]),t._v(" "),e("p",[t._v("下面这个例子演示了怎样创建一个订阅了 "),e("code",[t._v("sensor_combined")]),t._v(" 主题并打印 (来自PX4) 的消息更新的 "),e("em",[t._v("Fast RTPS")]),t._v(' "监听" 应用。 一个已连接的 RTPS 应用可以在与 '),e("em",[t._v("Agent")]),t._v(" 同一网段的任何计算机上运行。 在这个例子中 "),e("em",[t._v("Agent")]),t._v(" and "),e("em",[t._v("监听应用")]),t._v(" 在同一台计算机上运行。")]),t._v(" "),e("h2",{attrs:{id:"构建-px4-ros-com-程序包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建-px4-ros-com-程序包"}},[t._v("#")]),t._v(" 构建 "),e("code",[t._v("px4_ros_com")]),t._v(" 程序包")]),t._v(" "),e("p",[e("em",[t._v("fastrtpsgen")]),t._v(" 脚本可以从 IDL 消息文件创建一个简单的 RTPS 应用。")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("Only the master branch is needed for ROS2 (both are needed to target ROS).")])]),t._v(" "),e("h3",{attrs:{id:"分别安装-ros-和-ros2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分别安装-ros-和-ros2"}},[t._v("#")]),t._v(" 分别安装 ROS 和 ROS2")]),t._v(" "),e("p",[t._v("这段代码创建了一个基本的订阅器和广播器，和一个运行它们的主程序。 要打印来自 "),e("code",[t._v("sensor_combined")]),t._v(" 主题的数据, 修改 "),e("strong",[t._v("sensor_combined_Subscriber.cxx")]),t._v(" 文件中的 "),e("code",[t._v("onNewDataMessage()")]),t._v(" 方法。")]),t._v(" "),e("p",[t._v("要在Linux上构建并运行该应用：")]),t._v(" "),e("ol",[e("li",[e("p",[e("a",{attrs:{href:"http://wiki.ros.org/melodic/Installation/Ubuntu",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 ROS Melodic"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://index.ros.org/doc/ros2/Installation/Dashing/Linux-Install-Debians/",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 ROS2 Bouncy"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("要正常地生成 IDL 文件还要安装以下组件 (仅 ROS2 Bouncy 发行版需要):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" python3-colcon-common-extensions\n")])])])]),t._v(" "),e("li",[e("p",[e("em",[t._v("setuptools")]),t._v("也必须被安装 (使用 "),e("em",[t._v("pip")]),t._v(" 或 "),e("em",[t._v("apt")]),t._v("工具):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ros-bouncy-rmw-opensplice-cpp\n")])])])]),t._v(" "),e("li",[e("p",[t._v("安装过程应该会自动安装 "),e("em",[t._v("colcon")]),t._v(" 构建工具，万一没有，也可手动安装:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" pip3 "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -U setuptools\n")])])]),e("p",[t._v(":::caution Do not install the "),e("code",[t._v("ros1_bridge")]),t._v(" package through the deb repository. The package must be built from source.\n:::")])])]),t._v(" "),e("h3",{attrs:{id:"配置工作空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置工作空间"}},[t._v("#")]),t._v(" 配置工作空间")]),t._v(" "),e("p",[t._v("Since the ROS2 and ROS require different environments you will need a separate workspace for each ROS version. As an example:")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("对于 ROS2, 如下创建工作空间:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/px4_ros_com_ros2/src\n")])])]),e("p",[t._v("然后，把 ROS2 ("),e("code",[t._v("master")]),t._v(") 分支克隆到 "),e("code",[t._v("/src")]),t._v(" 目录:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros2/src/px4_ros_com "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 克隆 master 分支")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("对于 ROS, 遵循同样的流程, 但是要另建一个目录并克隆另一个分支:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/px4_ros_com_ros1/src\n")])])]),e("p",[t._v("然后，克隆 ROS2 ("),e("code",[t._v("ros1")]),t._v(") 分支到 "),e("code",[t._v("/src")]),t._v(" 目录:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros1/src/px4_ros_com -b ros1 "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 克隆 'ros1' 分支")]),t._v("\n")])])])])]),t._v(" "),e("h3",{attrs:{id:"构建工作空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建工作空间"}},[t._v("#")]),t._v(" 构建工作空间")]),t._v(" "),e("p",[t._v("如果 "),e("code",[t._v("px4_ros_com")]),t._v(" 已经构建成功, 你可以利用生成的 "),e("em",[t._v("micro-RTPS")]),t._v(" 代理程序和自动生成的ROS2消息源文件和头文件，这些文件与 uORB 消息是一一对应的。")]),t._v(" "),e("p",[t._v("To build both workspaces with a single script, use the "),e("code",[t._v("build_all.bash")]),t._v(". Check the usage with "),e("code",[t._v("source build_all.bash --help")]),t._v(". The most common way of using it is by passing the ROS(1) workspace directory path and also the PX4-Autopilot directory path:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" build_all.bash --ros1_ws_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/px4_ros_com_ros1/ws"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("p",[t._v("上面两行代码将与ROS2中间件交互的 C++ 库包含进来。 同时还包含了我们要用到的消息头文件。")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The build process will open new tabs on the console, corresponding to different stages of the build process that need to have different environment configurations sourced.")])]),t._v(" "),e("p",[t._v("One can also use the following individual scripts in order to build the individual parts:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("build_ros1_bridge.bash")]),t._v(" 可以构建 "),e("code",[t._v("ros1_bridge")]),t._v(";")]),t._v(" "),e("li",[e("code",[t._v("build_ros2_workspace.bash")]),t._v(" (只构建 "),e("code",[t._v("px4_ros_com")]),t._v(" 的 "),e("code",[t._v("ros1")]),t._v(" 分支) 可以构建 "),e("code",[t._v("px4_ros_com")]),t._v(" "),e("code",[t._v("ros1")]),t._v(" 分支所在的 ROS1 工作空间;")]),t._v(" "),e("li",[e("code",[t._v("build_ros2_workspace.bash")]),t._v(" 可以构建 "),e("code",[t._v("px4_ros_com")]),t._v(" "),e("code",[t._v("master")]),t._v(" 分支所在的工作空间;")])]),t._v(" "),e("p",[t._v("上面这段代码创建了 "),e("code",[t._v("sensor_combined_topic")]),t._v(" 主题的订阅，可以匹配到一个或多个该消息的 ROS 广播者上。")]),t._v(" "),e("ol",[e("li",[e("p",[e("code",[t._v("cd")]),t._v(" 到 "),e("code",[t._v("px4_ros_com_ros2")]),t._v(" 目录并 source 一下 ROS2 的环境变量。 不用管是否提示您该工作空间已经设置过：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/bouncy/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("克隆 "),e("code",[t._v("ros1_bridge")]),t._v(" 程序包到 ROS2 工作空间:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/ros2/ros1_bridge.git ~/px4_ros_com_ros2/src/ros1_bridge\n")])])])]),t._v(" "),e("li",[e("p",[t._v("构建 "),e("code",[t._v("px4_ros_com")]),t._v(" 程序包, 并排除 "),e("code",[t._v("ros1_bridge")]),t._v(" 程序包：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("colcon build --symlink-install --packages-skip ros1_bridge --event-handlers console_direct+\n")])])]),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v('`--event-handlers console_direct+` only serves the purpose of adding verbosity to the `colcon` build process and can be removed if one wants a more "quiet" build.')])])])]),t._v(" "),e("p",[t._v(":::")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("然后，按照 ROS(1) 程序包的构建流程进行编译。 为此，您必须先 source 一下环境变量，使 "),e("code",[t._v("ros1_bridge")]),t._v(" 在构建过程中能够在 PATH 变量下找到 ROS1 和 ROS2 所设置的路径：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/melodic/setup.bash\n "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/bouncy/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在 ROS 这一端构建 "),e("code",[t._v("px4_ros_com")]),t._v(" 程序包：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --event-handlers console_direct+\n")])])])]),t._v(" "),e("li",[e("p",[t._v("然后 source 一下工作空间：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros1/install/setup.bash\n "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("最后，编译 "),e("code",[t._v("ros1_bridge")]),t._v("。 请注意, 构建过程可能会占用大量内存资源。 在内存较小的机器上, 减少并行编译的线程数目 (比如可以设置环境变量 "),e("code",[t._v("MAKEFLAGS=-j1")]),t._v(")。 要查看编译过程的更详细信息，请移步 "),e("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),e("OutboundLink")],1),t._v("程序包的网页。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --packages-select ros1_bridge --cmake-force-configure --event-handlers console_direct+\n")])])])])]),t._v(" "),e("h3",{attrs:{id:"清理工作空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#清理工作空间"}},[t._v("#")]),t._v(" 清理工作空间")]),t._v(" "),e("p",[t._v("After building the workspaces there are many files that must be deleted before you can do a clean/fresh build (for example, after you have changed some code and want to rebuild). Unfortunately "),e("em",[t._v("colcon")]),t._v(" does not currently have a way of cleaning the generated "),e("strong",[t._v("build")]),t._v(", "),e("strong",[t._v("install")]),t._v(" and "),e("strong",[t._v("log")]),t._v(" directories, so these directories must be deleted manually.")]),t._v(" "),e("p",[t._v("The "),e("strong",[t._v("clean_all.bash")]),t._v(" script (in "),e("strong",[t._v("px4_ros_com/scripts")]),t._v(") is provided to ease this cleaning process. The most common way of using it is by passing it the ROS(1) workspace directory path (since it's usually not on the default path):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" build_all.bash --ros1_ws_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/px4_ros_com_ros1/ws"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --px4_firmware_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/PX4/Firmware"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("h2",{attrs:{id:"创建一个-fast-rtps-监听应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个-fast-rtps-监听应用"}},[t._v("#")]),t._v(" 创建一个 Fast RTPS 监听应用")]),t._v(" "),e("p",[t._v("以 "),e("code",[t._v("px4_ros_com/src/listeners")]),t._v(" 目录下的 "),e("code",[t._v("debug_vect_advertiser.cpp")]),t._v(" 为例：")]),t._v(" "),e("p",[t._v("This example shows how to create a "),e("em",[t._v("Fast RTPS")]),t._v(' "listener" application that subscribes to the '),e("code",[t._v("sensor_combined")]),t._v(" topic and prints out updates (from PX4). A connected RTPS application can run on any computer on the same network as the "),e("em",[t._v("Agent")]),t._v(". For this example the "),e("em",[t._v("Agent")]),t._v(" and "),e("em",[t._v("Listener application")]),t._v(" will be on the same computer.")]),t._v(" "),e("p",[t._v("上面这行代码创建了一个 "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" 类，继承自 "),e("code",[t._v("rclcpp::Node")]),t._v(" 基类。")]),t._v(" "),e("p",[t._v("这段代码创建了一个用来发送消息的回调函数。 发送消息的回调函数由定时器触发的，每秒钟发送两次消息。 These IDL files are needed when you create a "),e("em",[t._v("Fast RTPS")]),t._v(" application to communicate with PX4.\n:::")]),t._v(" "),e("p",[t._v("这段代码在 "),e("code",[t._v("main")]),t._v(" 函数中将 "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" 类实例化成一个ROS节点。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" clean_all.bash --ros1_ws_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("path/to/px4_ros_com_ros1/ws"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("创建ROS节点的方法有详细的文档供参考，不在赘述。 在 "),e("code",[t._v("ros1")]),t._v(" 分支的代码的 "),e("code",[t._v("px4_ros_com/src/listeners")]),t._v(" 目录下，有一个关于 "),e("code",[t._v("sensor_combined")]),t._v(" 消息的ROS 监听器的例子。")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" sensor_combined_Subscriber"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubListener")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNewDataMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Subscriber"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sub"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Take data")]),t._v("\n    sensor_combined_ st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeNextData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("m_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sampleKind "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ALIVE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Print your structure data here.")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("n_msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sample received, count="')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" n_msg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"============================="')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_integral_dt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_integral_dt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_ga: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_alt_meter: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_alt_meter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_temp_celcius: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_temp_celcius")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("下面是PX4-FastRTPS桥接在实际应用中的更多示例。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" -f makefile_x64Linux2.6gcc\nbin/*/sensor_combined_PublisherSubscriber subscriber\n")])])]),e("p",[t._v("快速测试该模块的流程如下 (使用 PX4 SITL 和 Gazebo)：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("Sample received, "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10119")]),t._v("\nReceived sensor_combined data\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\ngyro_rad: -0.0103228, "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0140477")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000319406")]),t._v("\ngyro_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.004")]),t._v("\naccelerometer_timestamp_relative: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naccelerometer_m_s2: -2.82708, -6.34799, -7.41101\naccelerometer_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.004")]),t._v("\nmagnetometer_timestamp_relative: -10210\nmagnetometer_ga: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.60171")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0405879")]),t._v(", -0.040995\nbaro_timestamp_relative: -17469\nbaro_alt_meter: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("368.647")]),t._v("\nbaro_temp_celcius: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("43.93")]),t._v("\n")])])]),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("If the "),e("em",[t._v("Listener application")]),t._v(" does not print anything, make sure the "),e("em",[t._v("Client")]),t._v(" is running.")])]),t._v(" "),e("h2",{attrs:{id:"创建一个-ros2-监听器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个-ros2-监听器"}},[t._v("#")]),t._v(" 创建一个 ROS2 监听器")]),t._v(" "),e("p",[t._v("With the "),e("code",[t._v("px4_ros_com")]),t._v(" built successfully, one can now take advantage of the generated "),e("em",[t._v("micro-RTPS")]),t._v(" agent app and also from the generated sources and headers of the ROS2 msgs from "),e("code",[t._v("px4_msgs")]),t._v(", which represent a one-to-one matching with the uORB counterparts.")]),t._v(" "),e("p",[e("em",[t._v("Agent")]),t._v("代码是由一个叫做 "),e("em",[t._v("fastrtpsgen")]),t._v(" 的 "),e("em",[t._v("Fast RTPS")]),t._v(" 工具生成的。")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<rclcpp/rclcpp.hpp>")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<px4_ros_com/msg/sensor_combined.hpp>")])]),t._v("\n")])])]),e("p",[t._v("The above brings to use the required C++ libraries to interface with the ROS2 middleware. It also includes the required message header file.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @brief Sensor Combined uORB topic data callback\n */")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SensorCombinedListener")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token base-clause"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),e("p",[t._v("在 Linux/Mac 平台上可以这样：")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" sensor_combined_Subscriber"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubListener")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNewDataMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Subscriber"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sub"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Take data")]),t._v("\n    sensor_combined_ st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeNextData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("m_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sampleKind "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ALIVE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Print your structure data here.")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("n_msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sample received, count="')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" n_msg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"============================="')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_integral_dt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_integral_dt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_ga: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_timestamp_relative")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_alt_meter: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_alt_meter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_temp_celcius: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_temp_celcius")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("This creates a callback function for when the "),e("code",[t._v("sensor_combined")]),t._v(" uORB messages are received (now as DDS messages). It outputs the content of the message fields each time the message is received.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explicit")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SensorCombinedListener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sensor_combined_listener"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" px4_ros_com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SensorCombined"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RECEIVED DATA ON SENSOR COMBINED"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"================================"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[0]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[1]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[2]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_integral_dt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_timestamp_relative "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[0]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[1]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[2]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_integral_dt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("The above create a subscription to the "),e("code",[t._v("sensor_combined_topic")]),t._v(" which can be matched with one or more compatible ROS publishers.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting sensor_combined listener node..."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SensorCombinedListener"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The instantiation of the "),e("code",[t._v("SensorCombinedListener")]),t._v(" class as a ROS node is done on the "),e("code",[t._v("main")]),t._v(" function.")]),t._v(" "),e("h2",{attrs:{id:"创建一个ros2广播器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个ros2广播器"}},[t._v("#")]),t._v(" 创建一个ROS2广播器")]),t._v(" "),e("p",[t._v("A ROS2 advertiser node publishes data into the DDS/RTPS network (and hence to PX4).")]),t._v(" "),e("p",[t._v("Taking as an example the "),e("code",[t._v("debug_vect_advertiser.cpp")]),t._v(" under "),e("code",[t._v("px4_ros_com/src/advertisers")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting sensor_combined listener node..."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SensorCombinedListener"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Bring in the required headers, including the "),e("code",[t._v("debug_vect")]),t._v(" msg header.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DebugVectAdvertiser")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token base-clause"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),e("p",[t._v("The above creates a "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" class that subclasses the generic "),e("code",[t._v("rclcpp::Node")]),t._v(" base class.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVectAdvertiser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug_vect_advertiser"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        publisher_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("create_publisher"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_ros_com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("DebugVect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DebugVect_topic"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" timer_callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" debug_vect "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" px4_ros_com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("nanoseconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1E-3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RCLCPP_INFO")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_logger")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Publishing debug_vect: time: %f x:%f y:%f z:%f"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("publisher_"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        timer_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_wall_timer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timer_callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("TimerBase"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr timer_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Publisher"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_ros_com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("DebugVect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr publisher_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("This creates a function for when messages are to be sent. The messages are sent based on a timed callback, which sends two messages per second based on a timer.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting debug_vect advertiser node..."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DebugVectAdvertiser"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DebugVectAdvertiser"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The instantiation of the "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" class as a ROS node is done on the "),e("code",[t._v("main")]),t._v(" function.")]),t._v(" "),e("h2",{attrs:{id:"创建一个ros监听器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个ros监听器"}},[t._v("#")]),t._v(" 创建一个ROS监听器")]),t._v(" "),e("p",[t._v("The creation of ROS nodes is a well known and documented process. An example of a ROS listener for "),e("code",[t._v("sensor_combined")]),t._v(" messages can be found in the "),e("code",[t._v("ros1")]),t._v(" branch repo, under "),e("code",[t._v("px4_ros_com/src/listeners")]),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"与ros无关的应用程序的示例-测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与ros无关的应用程序的示例-测试"}},[t._v("#")]),t._v(" 与ROS无关的应用程序的示例/测试")]),t._v(" "),e("p",[t._v("The following examples provide additional real-world demonstrations of how to use the features described in this topic.")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/zh/middleware/micrortps_throughput_test.html"}},[t._v("吞吐量测试")]),t._v(": 一个测试PX4-FastRTPS桥接吞吐量的简单示例。")],1)]),t._v(" "),e("h2",{attrs:{id:"px4-fastrpts桥接与-ros2-和-ros-的联合测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#px4-fastrpts桥接与-ros2-和-ros-的联合测试"}},[t._v("#")]),t._v(" PX4-FastRPTS桥接与 ROS2 和 ROS 的联合测试")]),t._v(" "),e("p",[t._v("To quickly test the package (using PX4 SITL with Gazebo):")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("启动 PX4 SITL 和 Gazebo：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_sitl_rtps gazebo\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在一个终端里，source 一下 ROS2 工作空间的环境变量，然后启动 "),e("code",[t._v("ros1_bridge")]),t._v(" (这样 ROS2 和 ROS 节点就可以互相通信了)。 还要将 "),e("code",[t._v("ROS_MASTER_URI")]),t._v(" 设置为 "),e("code",[t._v("roscore")]),t._v(" 正在/即将运行的IP。")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/ardent/setup.bash\n $ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_MASTER_URI")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://localhost:11311\n $ ros2 run ros1_bridge dynamic_bridge\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在另一个终端里，source 一下 ROS 工作空间的环境变量，然后启动 "),e("code",[t._v("sensor_combined")]),t._v(" 监听器节点。 使用 "),e("code",[t._v("roslaunch")]),t._v(" 启动应用程序时，首先会自动启动 "),e("code",[t._v("roscore")]),t._v(" ：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros1/install/setup.bash\n $ roslaunch px4_ros_com sensor_combined_listener.launch\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在一个终端里，source 一下 ROS2 工作空间的环境变量，然后启动 "),e("code",[t._v("micrortps_agent")]),t._v(" 守护程序并使用UDP传输协议：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ micrortps_agent -t UDP\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在 "),e("RouterLink",{attrs:{to:"/zh/debug/system_console.html"}},[t._v("NuttShell/System 控制台")]),t._v(" 里， 启动 "),e("code",[t._v("micrortps_client")]),t._v(" 守护进程，也使用UDP协议：")],1),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" micrortps_client start -t UDP\n")])])]),e("p",[t._v("现在启动 ROS 监听器，你就可以在终端/控制台上看到数据被打印出来：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("RECEIVED DATA FROM SENSOR COMBINED\n "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00341645")]),t._v("\n gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00626475")]),t._v("\n gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.000515705\n gyro_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\n accelerometer_timestamp_relative: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.273381\n accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0949186")]),t._v("\n accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -9.76044\n accelerometer_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\n\n Publishing back"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),e("p",[t._v("你还可以使用 "),e("code",[t._v("rostopic hz")]),t._v(" 命令来检查消息的发送频率。 例如 "),e("code",[t._v("sensor_combined")]),t._v(" 消息：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.187")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2724")]),t._v("\n average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.006")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2972")]),t._v("\n average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.330")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3212")]),t._v("\n average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.497")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3464")]),t._v("\n average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.458")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3712")]),t._v("\n average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.485")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3960")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("在一个终端里，你也可以使用以下命令来测试 "),e("code",[t._v("sensor_combined")]),t._v(" ROS2 监听器：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ sensor_combined_listener "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or ros2 run px4_ros_com sensor_combined_listener")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("And it should also get data being printed to the console output.")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("If ones uses the "),e("code",[t._v("build_all.bash")]),t._v(" script, it automatically open and source all the required terminals so one just has to run the respective apps in each terminal.")])]),t._v(" "),e("h2",{attrs:{id:"故障处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#故障处理"}},[t._v("#")]),t._v(" 故障处理")]),t._v(" "),e("h3",{attrs:{id:"client-reports-that-selected-uart-port-is-busy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#client-reports-that-selected-uart-port-is-busy"}},[t._v("#")]),t._v(" Client reports that selected UART port is busy")]),t._v(" "),e("p",[t._v("If the selected UART port is busy, it's possible that the MAVLink application is already being used. If both MAVLink and RTPS connections are required you will have to either move the connection to use another port or configure the port so that it can be shared.\n")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("A quick/temporary fix to allow bridge testing during development is to stop MAVLink from "),e("em",[t._v("NuttShell")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FASTRTPSGEN_DIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/path/to/fastrtps/install/folder/bin\n")])])])]),t._v(" "),e("h3",{attrs:{id:"agent-not-built-fastrtpsgen-is-not-found"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#agent-not-built-fastrtpsgen-is-not-found"}},[t._v("#")]),t._v(" Agent not built/fastrtpsgen is not found")]),t._v(" "),e("p",[t._v("The "),e("em",[t._v("Agent")]),t._v(" code is generated using a "),e("em",[t._v("Fast RTPS")]),t._v(" tool called "),e("em",[t._v("fastrtpsgen")]),t._v(".")]),t._v(" "),e("p",[t._v("If you haven't installed Fast RTPS in the default path then you must specify its installation directory by setting the "),e("code",[t._v("FASTRTPSGEN_DIR")]),t._v(" environment variable before executing "),e("em",[t._v("make")]),t._v(".")]),t._v(" "),e("p",[t._v("On Linux/Mac this is done as shown below:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FASTRTPSGEN_DIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/path/to/fastrtps/install/folder/bin\n")])])]),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("This should not be a problem if "),e("RouterLink",{attrs:{to:"/zh/dev_setup/fast-rtps-installation.html"}},[t._v("Fast RTPS is installed in the default location")]),t._v(".")],1)]),t._v(" "),e("h3",{attrs:{id:"enable-uart-on-an-obc-onboard-computer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enable-uart-on-an-obc-onboard-computer"}},[t._v("#")]),t._v(" Enable UART on an OBC (onboard computer)")]),t._v(" "),e("p",[t._v("For UART transport on a Raspberry Pi or any other OBC you will have to enable the serial port:")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("确保 "),e("code",[t._v("userid")]),t._v(" (在树莓派上默认用户是 pi) 是 "),e("code",[t._v("dialout")]),t._v(" 用户组的成员：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("groups")]),t._v(" pi\n "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("usermod")]),t._v(" -a -G dialout pi\n")])])])]),t._v(" "),e("li",[e("p",[t._v("特别针对树莓派，你需要关闭使用该端口的GPIO串行控制台：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" raspi-config\n")])])]),e("p",[t._v("在显示的菜单中进入 "),e("strong",[t._v("Interfacing options > Serial")]),t._v(" 选项。 为 "),e("em",[t._v("Would you like a login shell to be accessible over serial?")]),t._v(" 选择 "),e("strong",[t._v("NO")]),t._v(" 。 重启使之生效。")])]),t._v(" "),e("li",[e("p",[t._v("在内核中查看UART：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /boot/config.txt\n")])])]),e("p",[t._v("确保 "),e("code",[t._v("enable_uart")]),t._v(" 被设置为 1：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" enable_uart=1\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"更多信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更多信息"}},[t._v("#")]),t._v(" 更多信息")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/zh/dev_setup/fast-rtps-installation.html"}},[t._v("FastRTPS 安装")])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/zh/middleware/micrortps_manual_code_generation.html"}},[t._v("手动生成客户端和代理端代码")])],1),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/ros2/ros2/wiki/DDS-and-ROS-middleware-implementations",target:"_blank",rel:"noopener noreferrer"}},[t._v("DDS 和 ROS 中间件的实现"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);