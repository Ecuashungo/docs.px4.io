(window.webpackJsonp=window.webpackJsonp||[]).push([[1240],{2631:function(a,e,t){"use strict";t.r(e);var s=t(18),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"uavcan-bootloader-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uavcan-bootloader-安装"}},[a._v("#")]),a._v(" UAVCAN Bootloader 安装")]),a._v(" "),t("blockquote",[t("p",[a._v("** 警告 **UAVCAN 设备通常使用预安装的引导程序装运。 除非您正在开发 UAVCAN 设备, 否则请不要按照本节中的说明操作。")])]),a._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),t("p",[a._v("PX4 项目包含一个用于 STM32 设备的标准 UAVCAN 引导程序。")]),a._v(" "),t("p",[a._v("引导程序占用第一个 8–16 KB 的闪存, 并且是第一个在开机时执行的代码。 通常, 引导程序执行低级设备初始化, 自动确定 can 总线波特率, 充当 UAVCAN 动态节点 id 客户端以获取唯一的节点 id, 并等待飞行控制器的确认, 然后再继续应用程序启动。")]),a._v(" "),t("p",[a._v("此过程确保 UAVCAN 设备可以从无效或损坏的应用程序固件中恢复, 而无需用户干预, 并且还允许自动固件更新。")]),a._v(" "),t("h2",{attrs:{id:"系统必备组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统必备组件"}},[a._v("#")]),a._v(" 系统必备组件")]),a._v(" "),t("p",[a._v("安装或更新 UAVCAN 引导加载程序需要：")]),a._v(" "),t("ul",[t("li",[a._v("SWD或 JTAG 接口 (视设备而定), 例如 "),t("a",{attrs:{href:"http://www.blacksphere.co.nz/main/blackmagic",target:"_blank",rel:"noopener noreferrer"}},[a._v(" BlackMagic Probe "),t("OutboundLink")],1),a._v(" 或 "),t("a",{attrs:{href:"http://www.st.com/internet/evalboard/product/251168.jsp",target:"_blank",rel:"noopener noreferrer"}},[a._v(" ST Link v2 "),t("OutboundLink")],1),a._v(";")]),a._v(" "),t("li",[a._v("用于将您的SWD或 JTAG 接口连接到 UAVCAN 设备的调试端口的适配器电缆;")]),a._v(" "),t("li",[t("RouterLink",{attrs:{to:"/zh/setup/dev_env.html"}},[a._v(" 支持的 ARM 工具链 ")]),a._v("。")],1)]),a._v(" "),t("h2",{attrs:{id:"设备准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设备准备"}},[a._v("#")]),a._v(" 设备准备")]),a._v(" "),t("p",[a._v("如果无法使用下面的说明连接到设备, 则该设备上已存在的固件可能已禁用 MCU 的调试针脚。 要从中恢复, 您需要将接口的 NRST 或 nSRST pin (标准20针连接器上的 15引脚) 连接到 MCU 的 NRST 引脚。 获取设备示意图和 PCB 布局, 或与制造商联系以了解详细信息。")]),a._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("p",[a._v("在编译或获取设备的引导程序映像后 (有关详细信息, 请参阅设备文档), 引导加载程序必须复制到设备闪存的开头。")]),a._v(" "),t("p",[a._v("这样做的过程取决于SWD或 JTAG 的使用接口。")]),a._v(" "),t("h2",{attrs:{id:"blackmagic-probe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#blackmagic-probe"}},[a._v("#")]),a._v(" BlackMagic Probe")]),a._v(" "),t("p",[a._v("确保 BlackMagic Probe "),t("a",{attrs:{href:"https://github.com/blacksphere/blackmagic/wiki/Hacking",target:"_blank",rel:"noopener noreferrer"}},[a._v("firmware is up to date"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("p",[a._v("将探头连接到 UAVCAN 设备，然后将探头连接到计算机。")]),a._v(" "),t("p",[a._v("识别探针的设备名称。 Identify the probe's device name. This will typically be "),t("code",[a._v("/dev/ttyACM<x>")]),a._v(" or "),t("code",[a._v("/dev/ttyUSB<x>")]),a._v(".")]),a._v(" "),t("p",[a._v("启动 UAVCAN 设备，然后运行：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("arm-none-eabi-gdb /path/to/your/bootloader/image.elf\n")])])]),t("p",[a._v("在 "),t("code",[a._v("gdb")]),a._v(" 提示符下，运行：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("target extended /dev/ttyACM0\nmonitor connect_srst "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v("\nmonitor swdp_scan\nattach "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" mem inaccessible-by-default off\nload\nrun\n")])])]),t("p",[a._v("如果 "),t("code",[a._v("monitor swdp_scan")]),a._v(" 返回错误，请确保您的接线正确，并且您拥有最新版本的 BlackMagic 固件。")]),a._v(" "),t("h2",{attrs:{id:"st-link-v2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#st-link-v2"}},[a._v("#")]),a._v(" ST-Link v2")]),a._v(" "),t("p",[a._v("确保您拥有最新版本-至少 0.9.0-of "),t("a",{attrs:{href:"http://openocd.org",target:"_blank",rel:"noopener noreferrer"}},[a._v("OpenOCD"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("p",[a._v("将 ST-Link 连接到 UAVCAN 设备，然后将 ST-Link 连接到计算机。")]),a._v(" "),t("p",[a._v("启动 UAVCAN 设备，然后运行：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("openocd -f /path/to/your/openocd.cfg "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\narm-none-eabi-gdb /path/to/your/bootloader/image.elf\n")])])]),t("p",[a._v("在 "),t("code",[a._v("gdb")]),a._v(" 提示符下，运行：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("target extended-remote localhost:3333\nmonitor reset "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("halt")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" mem inaccessible-by-default off\nload\nrun\n")])])]),t("h2",{attrs:{id:"segger-j-link-调试器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#segger-j-link-调试器"}},[a._v("#")]),a._v(" Segger J-Link 调试器")]),a._v(" "),t("p",[a._v("将 JLink 调试器连接到 UAVCAN 设备，并将 JLink 调试器连接到计算机。")]),a._v(" "),t("p",[a._v("启动 UAVCAN 设备，然后运行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("JLinkGDBServer -select USB=0 -device STM32F446RE -if SWD-DP -speed 20000 -vd\n")])])]),t("p",[a._v("打开第二个终端，转到包含 esc 的 px4esc_1_6-bootloader.elf 的目录并运行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("arm-none-eabi-gdb px4esc_1_6-bootloader.elf\n")])])]),t("p",[a._v("在 "),t("code",[a._v("gdb")]),a._v(" 提示符下，运行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("tar ext :2331\nload\n")])])]),t("h2",{attrs:{id:"使用segger-jink-调试器擦除flash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用segger-jink-调试器擦除flash"}},[a._v("#")]),a._v(" 使用SEGGER Jink 调试器擦除Flash")]),a._v(" "),t("p",[a._v("As a recovery method it may be useful to erase flash to factory defaults such that the firmware is using the default parameters. Go to the directory of your SEGGER installation and launch JLinkExe, then run: 转到 SEGGER 安装目录并启动 JLinkExe，然后运行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("device &lt;name-of-device&gt;\nerase\n")])])]),t("p",[a._v("将 "),t("code",[a._v("&lt;name-of-device&gt;")]),a._v("替换为微控制器的名称，例如 用于 Pixhawk ESC 1.6 的 STM32F446RE 或用于 SV2470VC ESC 的 STM32F302K8。")])])}),[],!1,null,null,null);e.default=r.exports}}]);